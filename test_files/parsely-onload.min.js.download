function ParselyFilterStory(blackList,newUrlList,newHeadlineList){this.BlackList=blackList,this.NewUrlList=newUrlList,this.NewHeadlineList=newHeadlineList,this.IsRecommended=function(sStory){'use strict';function ImageExist(ImageUrl){var http=new XMLHttpRequest();return http.open('HEAD',ImageUrl,!1),http.send(),http.status!=404;}var storyHistoryString=window.localStorage[PARSELY.config.parsely_site_uuid+'-history'];if(storyHistoryString){var stroryHistoryArray=JSON.parse(storyHistoryString);if(stroryHistoryArray.indexOf(sStory.Url)>-1)return!1;}return blackList&&blackList.Links.indexOf(sStory.Url)>-1?!1:sStory.ImageUrl&&sStory.ImageUrl.indexOf('https://cdn.thestar.com.my/Themes/img/newTsol_logo_socmedia.png')!==-1?!1:!0;},this.ReplaceNewHeadlineOrUrl=function(sStory){'use strict';var newUrlListData=newUrlList.Data;for(var i=0;i<newUrlListData.length;i++)newUrlListData[i].OldUrl.trim()===sStory.Url.trim()&&newUrlListData[i].Headline.trim()===sStory.Title.trim()&&(sStory.Url=newUrlListData[i].NewUrl);var newHeadlineListData=newHeadlineList.Data;for(var j=0;j<newHeadlineListData.length;j++)newHeadlineListData[j].Url.trim()===sStory.Url.trim()&&(sStory.Title=newHeadlineListData[j].Headline);return sStory;},this.GetSectionHtml=function(Url){'use strict';function isInt(value){return!isNaN(value)&&parseInt(Number(value))==value&&!isNaN(parseInt(value,10));}var seperator='/';var urlArray=Url.split(seperator);var sectionObj={};var startIndex=5;var notSectionName=['news'];var tsolDomain='www.thestar.com.my/';var star2Domain='www.star2.com/';if(Url.indexOf(tsolDomain)>-1){if(urlArray.length>startIndex){var sectionName='';var indexArray=startIndex;do if(sectionName=urlArray[indexArray].replace(new RegExp('-','g'),' '),indexArray--,indexArray===2)break;while(isInt(sectionName)||jQuery.inArray(sectionName,notSectionName)>-1);var sectionUrl=urlArray.splice(0,indexArray+2).join(seperator);sectionObj.Url=sectionUrl,sectionObj.Name=sectionName;}}else Url.indexOf(star2Domain)>-1&&(sectionObj.Url='http://'+star2Domain,sectionObj.Name='star2');return sectionObj;},this.ReplaceStar2ImageRatio=function(imageUrl,targetRatio){'use strict';var star2Domain='www.star2.com/';if(imageUrl&&targetRatio&&imageUrl.indexOf(star2Domain)>-1)try{var urlSlashArray=imageUrl.split('/');var titleArray=urlSlashArray[urlSlashArray.length-1].split('-');var titleRatio=titleArray[titleArray.length-1];var parselyRatio='150x150';titleRatio.indexOf(parselyRatio)>-1&&(imageUrl=imageUrl.replace(parselyRatio,targetRatio));}catch(e){}return imageUrl;};}var onLoadParselyFunctions=[];var onLoadParselyFunctionsWithList=[];var onLoadParselyFunctionsWithList_History_Trending=[];var isLoadParsely=!0;PARSELY={onload:function(){function getGoogleSheetDataDeferredsArray(){'use strict';var blackListApiUrl='https://cdn.thestar.com.my/Components/GoogleSheet/BlackListParselyStories.json';var newUrlListApiUrl='https://cdn.thestar.com.my/Components/GoogleSheet/NewUrlList.json';var newHeadlineListApiUrl='https://cdn.thestar.com.my/Components/GoogleSheet/NewHeadlineList.json';var getDataDeferreds=[];return getDataDeferreds.push(jQuery.getJSON(blackListApiUrl,function(data){parselyUrlBlackList=data;}).fail(function(){})),getDataDeferreds.push(jQuery.getJSON(newUrlListApiUrl,function(data){parselyNewUrlList=data;}).fail(function(){})),getDataDeferreds.push(jQuery.getJSON(newHeadlineListApiUrl,function(data){parselyNewHeadlineList=data;}).fail(function(){})),getDataDeferreds;}var parselyUrlBlackList,parselyNewUrlList,parselyNewHeadlineList;if(isLoadParsely){if(onLoadParselyFunctionsWithList_History_Trending.length>0){var parselyHistory,parselyTrendStories;function getHistoryAndTrendingStoriesDataDeferredsArray(){var trendingJson='https://cdn.thestar.com.my/Components/parsely/TrendingTop7.json';var endpoint='/history';var params={apikey:'thestar.com.my',uuid:PARSELY.config.parsely_site_uuid};var recomBase=location.protocol+'//'+(location.hostname.indexOf('localhost')>=0?location.hostname+':'+location.port:location.hostname)+'/api/parselyrecommendations';var queryStr=jQuery.param(params);var historyApiUrl=recomBase+endpoint+'/?'+queryStr;var getDataDeferreds=[];return getDataDeferreds.push(jQuery.getJSON(historyApiUrl,function(history){parselyHistory=history;}).fail(function(){})),getDataDeferreds.push(jQuery.getJSON(trendingJson,function(trendStories){parselyTrendStories=trendStories;}).fail(function(){})),getDataDeferreds;}var dataDeferreds=getGoogleSheetDataDeferredsArray();var historyAndTrendDeferreds=getHistoryAndTrendingStoriesDataDeferredsArray();Array.prototype.push.apply(dataDeferreds,historyAndTrendDeferreds),jQuery.when.apply(jQuery,dataDeferreds).done(function(){var storyFilter=new ParselyFilterStory(parselyUrlBlackList,parselyNewUrlList,parselyNewHeadlineList);for(var i=0;i<onLoadParselyFunctionsWithList_History_Trending.length;i++)try{onLoadParselyFunctionsWithList_History_Trending[i](storyFilter,parselyHistory,parselyTrendStories);}catch(err){}});}if(onLoadParselyFunctionsWithList.length>0){var getGoogleSheetDataDeferreds=getGoogleSheetDataDeferredsArray();jQuery.when.apply(jQuery,getGoogleSheetDataDeferreds).done(function(){var storyFilter=new ParselyFilterStory(parselyUrlBlackList,parselyNewUrlList,parselyNewHeadlineList);for(var i=0;i<onLoadParselyFunctionsWithList.length;i++)try{onLoadParselyFunctionsWithList[i](storyFilter);}catch(err){}});}trainParsely();for(var indexpot=0;indexpot<onLoadParselyFunctions.length;indexpot++)try{onLoadParselyFunctions[indexpot]();}catch(err){}isLoadParsely=!1;}}};